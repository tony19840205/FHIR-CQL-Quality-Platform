# ğŸš¨ FHIR ä¼ºæœå™¨æ¸¬è©¦çµæœå ±å‘Š
**æ¸¬è©¦æ™‚é–“**ï¼š2025-12-08 ä¸‹åˆ
**æ¸¬è©¦è€…**ï¼šGitHub Copilot
**æ¸¬è©¦å·¥å…·**ï¼šPowerShell Invoke-RestMethod

---

## ğŸ“Š æ¸¬è©¦çµæœç¸½è¦½

| ä¼ºæœå™¨ | URL | ç‹€æ…‹ | éŒ¯èª¤ä»£ç¢¼ | å‚™è¨» |
|--------|-----|------|----------|------|
| ğŸ”´ Taiwan MOHW | https://thas.mohw.gov.tw/v/r4/fhir | **å¤±æ•—** | **502 Bad Gateway** | ä¼ºæœå™¨åœæ©Ÿæˆ–ç¶­è­· |
| ğŸ”´ SMART Health IT | https://r4.smarthealthit.org | **å¤±æ•—** | **502 Bad Gateway** | ä¼ºæœå™¨å•é¡Œ |
| âœ… **Firely Server** | https://server.fire.ly/r4 | **âœ… å¯ç”¨** | **200 OK** | **FHIR 4.0.1** â­ |
| ğŸ”´ HAPI FHIR | https://hapi.fhir.org/baseR4 | **å¤±æ•—** | **404 Not Found** | å·²æ°¸ä¹…åœç”¨ |

---

## âœ… å”¯ä¸€å¯ç”¨ï¼šFirely Server

### åŸºæœ¬è³‡è¨Š
- **URL**ï¼š`https://server.fire.ly/r4`
- **FHIR ç‰ˆæœ¬**ï¼š4.0.1
- **ç‹€æ…‹**ï¼šæ­£å¸¸é‹ä½œ âœ…
- **é™åˆ¶**ï¼š
  - å¯èƒ½ä¸æ”¯æ´å®Œæ•´çš„ Transaction Bundle
  - å»ºè­°ä½¿ç”¨å–®ä¸€è³‡æºä¸Šå‚³ï¼ˆPOST /Patient, POST /Observation ç­‰ï¼‰

---

## ğŸ¯ SAND-BOX æ¸¬è©¦å»ºè­°

### æ–¹æ¡ˆ Aï¼šä½¿ç”¨ Firely Serverï¼ˆæ¨è–¦ï¼‰â­

**åœ¨ SAND-BOX è¼¸å…¥ï¼š**
```
é¸æ“‡ï¼šEHR Launch
FHIR Server URLï¼šhttps://server.fire.ly/r4
Launch URLï¼šhttps://tony19840205.github.io/FHIR-CQL-Quality-Platform/index.html
```

**å„ªé»**ï¼š
- âœ… ä¼ºæœå™¨ç©©å®šé‹ä½œ
- âœ… æ”¯æ´ FHIR R4
- âœ… å…¬é–‹æ¸¬è©¦ç’°å¢ƒï¼Œç„¡éœ€æˆæ¬Š

**ç¼ºé»**ï¼š
- âš ï¸ å¯èƒ½ä¸æ”¯æ´ Transaction Bundle ä¸Šå‚³
- âš ï¸ éœ€è¦å–®ç¨ä¸Šå‚³æ¯å€‹è³‡æº

---

### æ–¹æ¡ˆ Bï¼šç­‰å¾… Taiwan MOHW æ¢å¾©

**ç•¶å‰å•é¡Œ**ï¼š
- ğŸ”´ **502 Bad Gateway** - ä¼ºæœå™¨å®Œå…¨ç„¡æ³•è¨ªå•
- ğŸ”´ é€£ metadata ç«¯é»éƒ½ç„¡æ³•é€£ç·š
- ğŸ”´ å¯èƒ½æ­£åœ¨ç¶­è­·æˆ–åœæ©Ÿ

**å»ºè­°**ï¼š
- ç­‰å¾… 1-2 å°æ™‚å¾Œé‡è©¦
- è¯ç¹«å°ç£è¡›ç¦éƒ¨ç¢ºèªä¼ºæœå™¨ç‹€æ…‹
- ä½¿ç”¨ Firely Server ä½œç‚ºè‡¨æ™‚æ›¿ä»£æ–¹æ¡ˆ

---

## ğŸ“¦ Postman æ¸¬è©¦æ­¥é©Ÿ

### 1. åŒ¯å…¥ Postman Collection

å·²å‰µå»ºæª”æ¡ˆï¼š`FHIR_Upload_Test.postman_collection.json`

**åŒ¯å…¥æ­¥é©Ÿ**ï¼š
1. é–‹å•Ÿ Postman
2. é»æ“Šã€ŒImportã€
3. é¸æ“‡ `FHIR_Upload_Test.postman_collection.json`
4. åŒ¯å…¥å®Œæˆ

### 2. æ¸¬è©¦ Firely Server

**æ­¥é©Ÿ**ï¼š
1. å±•é–‹ã€Œ1. Test Firely Server (Working)ã€
2. åŸ·è¡Œã€ŒGet Metadataã€â†’ æ‡‰è©²å›å‚³ 200 OK
3. åŸ·è¡Œã€ŒUpload Patient (Simple)ã€â†’ ä¸Šå‚³å–®ä¸€ç—…äºº
4. åŸ·è¡Œã€ŒQuery Recent Patientsã€â†’ æŸ¥è©¢å‰›ä¸Šå‚³çš„ç—…äºº

### 3. æ¸¬è©¦ Taiwan MOHWï¼ˆç•¶æ¢å¾©æ™‚ï¼‰

**æ­¥é©Ÿ**ï¼š
1. å±•é–‹ã€Œ2. Taiwan MOHW Server (502 Error)ã€
2. åŸ·è¡Œã€ŒGet Metadataã€â†’ æª¢æŸ¥æ˜¯å¦æ¢å¾©
3. å¦‚æœæˆåŠŸï¼ŒåŸ·è¡Œã€ŒUpload Bundleã€â†’ ä¸Šå‚³æ¸¬è©¦è³‡æ–™

---

## ğŸ”§ æ‰‹å‹•ä¸Šå‚³åˆ° Firely Server

### ä½¿ç”¨ PowerShell

```powershell
# ä¸Šå‚³å–®ä¸€ç—…äºº
$patient = @{
    resourceType = "Patient"
    id = "test-patient-001"
    name = @(
        @{
            family = "æ¸¬è©¦"
            given = @("ç—…äºº")
        }
    )
    gender = "female"
    birthDate = "1990-01-01"
} | ConvertTo-Json

$headers = @{
    "Content-Type" = "application/fhir+json"
    "Accept" = "application/fhir+json"
}

Invoke-RestMethod -Uri "https://server.fire.ly/r4/Patient" `
                  -Method Post `
                  -Body $patient `
                  -Headers $headers
```

### ä½¿ç”¨ curl

```bash
curl -X POST https://server.fire.ly/r4/Patient \
  -H "Content-Type: application/fhir+json" \
  -H "Accept: application/fhir+json" \
  -d '{
    "resourceType": "Patient",
    "id": "test-patient-001",
    "name": [{"family": "æ¸¬è©¦", "given": ["ç—…äºº"]}],
    "gender": "female",
    "birthDate": "1990-01-01"
  }'
```

---

## ğŸ’¡ å•é¡Œè¨ºæ–·èˆ‡è§£æ±º

### Q1: ç‚ºä»€éº¼ Taiwan MOHW é¡¯ç¤º 502ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š
1. ä¼ºæœå™¨æ­£åœ¨ç¶­è­·
2. ç¶²è·¯é–˜é“å•é¡Œ
3. æµé‡éå¤§å°è‡´æš«æ™‚åœæ©Ÿ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ç­‰å¾…ä¼ºæœå™¨æ¢å¾©ï¼ˆé€šå¸¸ 1-2 å°æ™‚ï¼‰
- ä½¿ç”¨ Firely Server ä½œç‚ºæ›¿ä»£
- è¯ç¹«è¡›ç¦éƒ¨æŠ€è¡“æ”¯æ´

### Q2: ç‚ºä»€éº¼ Firely Server ä¸Šå‚³ Bundle å¤±æ•— (400)ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š
- Firely Server å¯èƒ½ä¸å®Œå…¨æ”¯æ´ Transaction Bundle
- Bundle æ ¼å¼å•é¡Œ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨å–®ä¸€è³‡æºä¸Šå‚³ï¼ˆPOST /Patient, POST /Observation ç­‰ï¼‰
- ä¸è¦ä½¿ç”¨ Transaction Bundle
- é€ä¸€ä¸Šå‚³æ¯å€‹è³‡æº

### Q3: SAND-BOX Launch æ¸¬è©¦å¤±æ•—ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š
- Launch URL ä¸æ­£ç¢º
- FHIR Server ç„¡æ³•è¨ªå•
- CORS è¨­å®šå•é¡Œ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ç¢ºèª Launch URL å¯ä»¥åœ¨ç€è¦½å™¨é–‹å•Ÿ
- ç¢ºèª FHIR Server é€£ç·šæ­£å¸¸
- ä½¿ç”¨æœ¬åœ°æ¸¬è©¦ç’°å¢ƒï¼ˆhttp://localhost:8080ï¼‰

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡Œå‹•

### ç«‹å³å¯åšï¼š

1. **âœ… ä½¿ç”¨ Postman æ¸¬è©¦ Firely Server**
   - åŒ¯å…¥ `FHIR_Upload_Test.postman_collection.json`
   - åŸ·è¡Œã€ŒGet Metadataã€æ¸¬è©¦é€£ç·š
   - ä¸Šå‚³å–®ä¸€ç—…äººè³‡æ–™

2. **âœ… SAND-BOX Launch æ¸¬è©¦**
   - FHIR Server URLï¼š`https://server.fire.ly/r4`
   - Launch URLï¼šä½ çš„ GitHub Pages æˆ–æœ¬åœ° URL

### ç­‰å¾…æ¢ä»¶ï¼š

3. **â³ ç­‰å¾… Taiwan MOHW æ¢å¾©**
   - æ¯ 1-2 å°æ™‚æª¢æŸ¥ä¸€æ¬¡
   - æ¢å¾©å¾Œé‡æ–°æ¸¬è©¦

4. **â³ æº–å‚™å®Œæ•´è³‡æ–™ä¸Šå‚³**
   - ç­‰å¾…ç©©å®šçš„ FHIR Server
   - ä½¿ç”¨ `UPLOAD_ALL_650-850_PATIENTS.ps1` ä¸Šå‚³

---

## ğŸ¯ å»ºè­°å„ªå…ˆé †åº

1. **ç¾åœ¨**ï¼šä½¿ç”¨ Postman æ¸¬è©¦ Firely Serverï¼ˆ10 åˆ†é˜ï¼‰
2. **ç¾åœ¨**ï¼šSAND-BOX Launch æ¸¬è©¦ï¼ˆ5 åˆ†é˜ï¼‰
3. **ä»Šå¤©ç¨å¾Œ**ï¼šé‡æ–°æ¸¬è©¦ Taiwan MOHWï¼ˆç­‰å¾…æ¢å¾©ï¼‰
4. **æ˜å¤©**ï¼šæ±ºå®šæ˜¯å¦å¤§é‡ä¸Šå‚³è³‡æ–™åˆ° Firely Server

---

**æ¸¬è©¦å®Œæˆæ™‚é–“**ï¼š2025-12-08 ä¸‹åˆ
**çµè«–**ï¼šç›®å‰åƒ… Firely Server å¯ç”¨ï¼ŒTaiwan MOHW æš«æ™‚åœæ©Ÿï¼ˆ502ï¼‰ã€‚
