# FHIR 測試資料整合包說明

## 📦 資料概述

- **檔案名稱**: `complete_test_data_bundle.json`
- **總資源數**: 3,480 筆
- **檔案大小**: 9.59 MB
- **格式**: FHIR R4 Bundle (transaction type)
- **整合日期**: 2025-12-10

## 📊 資料來源

### 1. 645人完整包 (2025-12-08)
包含4個資料夾：
- **A_CGMH大批資料_508人**: 長庚醫院大批測試資料
- **B_HAPI小批資料_49人**: HAPI FHIR 測試資料
- **C_Dashboard資料_64人**: Dashboard 展示用資料
- **D_根目錄測試_24人**: 基礎測試資料

### 2. 根目錄測試資料 (2025-12-09 ~ 2025-12-10)
包含所有根目錄的測試JSON檔案（476筆資源），包括：

#### 用藥安全測試資料
- 同院降血壓藥重疊 (3 patients)
- 同院降血脂藥重疊 (5 patients)
- 同院降血糖藥重疊 (4 patients)
- 同院抗思覺失調藥重疊 (3 patients)
- 同院抗憂鬱藥重疊 (4 patients)
- 同院安眠鎮靜藥重疊 (4 patients)
- 同院抗血栓藥重疊 (4 patients)
- 同院前列腺藥重疊 (4 patients)
- 跨院降血壓藥重疊 (3 patients)
- 跨院降血脂藥重疊 (3 patients)
- 跨院降血糖藥重疊 (3 patients)
- 跨院抗思覺失調藥重疊 (3 patients)
- 跨院抗憂鬱藥重疊 (3 patients)
- 跨院安眠鎮靜藥重疊 (3 patients)
- 跨院抗血栓藥重疊 (3 patients)
- 跨院前列腺藥重疊 (3 patients)
- 跨院重度重疊 (5 patients)

#### 住院品質測試資料
- 出院後3天內急診 (6 patients)
- 剖腹產 (多組測試資料，含簡化版和完整版)
- 子宮肌瘤手術14天再入院 (2 patients, 已修正診斷碼位置)

#### 手術品質測試資料
- ESWL體外震波碎石術 (3 patients, Q4 2025)
- 急性心肌梗塞死亡率 (3 patients, Q4 2025)

#### 特殊測試資料
- 包含 SNOMED CT 和 ICD-10 雙編碼的測試資料
- 修正後的病人ID範圍測試資料 (TW10020, TW10021)

## 📋 資源類型統計

| 資源類型 | 數量 |
|---------|------|
| Encounter (就診記錄) | 883 |
| Patient (病人) | 751 |
| Condition (診斷) | 671 |
| MedicationRequest (用藥) | 663 |
| Procedure (處置) | 163 |
| MedicationAdministration (給藥) | 144 |
| Immunization (疫苗接種) | 122 |
| Observation (觀察值) | 69 |
| Organization (機構) | 5 |
| DocumentReference (文件參考) | 2 |
| DiagnosticReport (檢驗報告) | 1 |
| 其他 | 6 |

## 👥 病人資訊

- **總病人數**: 751 人
- **唯一病人ID數**: 671 個
- **病人ID範圍**:
  - 手術品質: TW10001-TW10046
  - 結果品質: TW20001-TW20012
  - 其他測試: CESAREAN-*, ESWL-*, FIBROID-*, 等

## 📅 資料時間範圍

- **主要季度**: 2025-Q4 (2025-10-01 ~ 2025-12-31)
- **包含歷史資料**: 2024-Q1 ~ 2025-Q3
- **測試資料日期**: 重點在 2025年10月~12月

## 🎯 適用指標

此測試資料包可用於驗證以下39項醫療品質指標：

### 用藥安全指標 (16項)
- 01: 門診注射劑使用率
- 02: 門診抗生素使用率
- 03-1 ~ 03-16: 同院/跨院藥物重疊率

### 門診品質指標 (4項)
- 04: 慢性病連續處方箋使用率
- 05: 處方10種以上藥品比率
- 06: 小兒氣喘急診率
- 07: 糖尿病HbA1c檢驗率
- 08: 同日同院同疾病再就診率

### 住院品質指標 (5項)
- 09: 非計畫性14天內再入院率
- 10: 出院後3天內急診率
- 11-1 ~ 11-4: 剖腹產率

### 手術品質指標 (10項)
- 12: 清淨手術抗生素超過3天使用率
- 13: ESWL平均利用次數
- 14: 子宮肌瘤手術14天再入院率
- 15-1 ~ 15-3: 人工膝關節置換感染率
- 16: 住院手術傷口感染率
- 19: 清淨手術傷口感染率

### 結果品質指標 (4項)
- 17: 急性心肌梗塞死亡率
- 18: 失智症安寧療護利用率

## 🚀 上傳方式

### 方式1: 完整上傳 (推薦在資料庫清空後)
```powershell
cd "C:\Users\tony1\Desktop\UI UX-20251122(0013)"

[System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true}
$bundle = Get-Content complete_test_data_bundle.json -Raw -Encoding UTF8
$response = Invoke-RestMethod -Uri 'https://thas.mohw.gov.tw/v/r4/fhir' `
                              -Method Post `
                              -Body $bundle `
                              -ContentType 'application/fhir+json' `
                              -TimeoutSec 600
Write-Host "上傳成功: $($response.entry.Count) 筆資源"
```

### 方式2: 分批上傳 (推薦)
使用提供的 `upload_batch.ps1` 腳本，每批500筆資源分批上傳。

```powershell
.\upload_batch.ps1
```

## ⚠️ 已知問題

1. **伺服器狀態**: 
   - 截至 2025-12-10，FHIR 伺服器 (https://thas.mohw.gov.tw/v/r4/fhir) 可能存在以下問題：
     - 400 Bad Request 錯誤
     - 無法接受大批量資料上傳
     - 可能需要管理員重啟或清理資料庫

2. **date 參數問題**:
   - FHIR 伺服器的 `date` 參數在 Encounter 和 Procedure 查詢中不工作
   - 已在 quality-indicators.js 中改用 client-side 日期過濾

3. **診斷碼格式**:
   - 伺服器主要使用 SNOMED CT 碼
   - 部分測試資料包含 ICD-10 雙編碼以提高相容性

## 📝 維護記錄

- **2025-12-08**: 初始 645人完整包
- **2025-12-09**: 新增指標10, 13, 14, 16, 19 測試資料
- **2025-12-10**: 
  - 新增指標11-1, 12 測試資料
  - 修正子宮肌瘤測試資料診斷碼位置
  - 新增SNOMED CT雙編碼測試資料
  - 整合所有測試資料為單一Bundle

## 🔧 技術規格

- **FHIR 版本**: R4
- **Bundle 類型**: transaction
- **編碼**: UTF-8
- **JSON深度**: 20層
- **相容性**: 符合 HL7 FHIR R4 規範

## 📞 聯絡資訊

如遇問題或需要更新資料，請聯繫系統管理員。

---
*最後更新: 2025-12-10*
