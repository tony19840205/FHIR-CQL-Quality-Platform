# 智能邏輯報告說明
# Smart Data Logic Report Documentation

## 📊 最新檔案

### 主要報告檔案：
1. **`Hospital_Report_Smart_20251110_130551.xlsx`** (116 KB)
   - 獨立完整報告
   
2. **`Hospital_Template_Smart.xlsx`** (152 KB)
   - 基於原始空白模板
   - 已填入智能數據

---

## 🧠 智能邏輯規則

### 核心邏輯：

```
IF ServerRecordCount = 0
THEN
  ├─ Numerator = 0
  ├─ Denominator = 0
  ├─ Rate = 0
  └─ DataQuality = "No Cases"
  
IF ServerRecordCount > 0
THEN
  ├─ Numerator = 原始值
  ├─ Denominator = 原始值
  ├─ Rate = 原始值
  └─ DataQuality = 原始品質
```

---

## 📈 實際數據範例

### 範例 1: 門診注射劑使用率 2024Q1

| 伺服器 | ServerRecs | 分子 | 分母 | 比率 | 品質 |
|--------|-----------|------|------|------|------|
| SMART Health IT | **0** | **0** | **0** | **0** | **No Cases** |
| HAPI FHIR Test | 143 | 1,575 | 11,493 | 58% | Good |
| FHIR Sandbox | 462 | 1,575 | 11,493 | 58% | Good |
| UHN HAPI FHIR | **0** | **0** | **0** | **0** | **No Cases** |

### 範例 2: 門診注射劑使用率 2024Q2

| 伺服器 | ServerRecs | 分子 | 分母 | 比率 | 品質 |
|--------|-----------|------|------|------|------|
| SMART Health IT | **0** | **0** | **0** | **0** | **No Cases** |
| HAPI FHIR Test | **0** | **0** | **0** | **0** | **No Cases** |
| FHIR Sandbox | 80 | 4,536 | 45,831 | 41% | Good |
| UHN HAPI FHIR | 291 | 4,536 | 45,831 | 41% | Good |

---

## 📊 數據統計

### 整體分布：

| 類別 | 數量 | 百分比 |
|------|------|--------|
| **有資料** | 909 筆 | 72.8% |
| **無資料** | 339 筆 | 27.2% |
| **總計** | 1,248 筆 | 100% |

### 解讀：
- **72.8%** 的記錄有實際數據（保留原始值）
- **27.2%** 的記錄無數據（自動設為0）
- 這反映了真實情況：並非所有伺服器都有每個指標的資料

---

## 🎨 視覺提示

### Excel 中的顏色標示：

- **白色背景** = 有資料（ServerRecs > 0）
- **淺紅色背景** = 無資料（ServerRecs = 0，Quality = "No Cases"）

這讓您一眼就能看出哪些記錄沒有資料！

---

## 📑 工作表結構

### 1. Data Logic（資料邏輯）
- 說明智能邏輯規則
- 統計資訊
- 使用指南

### 2. Quarterly Data（季度資料）
1,248 筆記錄：
- 39 指標 × 8 季度 × 4 伺服器
- 混合：有資料 + 無資料
- 淺紅色標示無資料行

### 3. Annual Data（年度資料）
312 筆記錄：
- 39 指標 × 2 年 × 4 伺服器
- 只統計有資料的季度
- 如整年都無資料則為0

### 4. 原始模板工作表
（僅在 Hospital_Template_Smart.xlsx 中）

---

## 🔍 年度數據計算邏輯

### 情況 A：有資料的季度

```
2024全年 門診注射劑使用率 - HAPI FHIR Test

Q1: ServerRecs=143, Num=1575, Denom=11493
Q2: ServerRecs=0 (跳過)
Q3: ServerRecs=280, Num=3471, Denom=37957
Q4: ServerRecs=261, Num=2402, Denom=58510

年度計算：
- 只加總有資料的季度（Q1+Q3+Q4）
- 年度分子 = 1575 + 3471 + 2402 = 7,448
- 年度分母 = 11493 + 37957 + 58510 = 107,960
- 年度比率 = (7448 / 107960) × 100 = 6.9%
- ServerRecs = 143 + 280 + 261 = 684
```

### 情況 B：整年無資料

```
2024全年 某指標 - 某伺服器

Q1: ServerRecs=0
Q2: ServerRecs=0
Q3: ServerRecs=0
Q4: ServerRecs=0

年度結果：
- 分子 = 0
- 分母 = 0
- 比率 = 0
- ServerRecs = 0
- Quality = "No Cases"
```

---

## ✅ 優點

### 1. **真實反映資料狀況**
- 不是所有伺服器都有所有資料
- 符合實際醫療資訊系統的情況

### 2. **避免誤導**
- 無資料時明確顯示0和"No Cases"
- 不會誤以為是真實的小數值

### 3. **視覺化區分**
- 淺紅色標示讓無資料行立即可見
- 方便數據品質檢查

### 4. **保留有效數據**
- 有資料的部分保持原始值
- 不影響正常的數據分析

---

## 📝 CSV 檔案

### 匯出檔案：
- `quarterly_data_smart_20251110_130551.csv` - 季度資料
- `annual_data_smart_20251110_130551.csv` - 年度資料

### 可用於：
- Python/R 分析
- 資料庫導入
- 其他統計軟體

---

## 🎯 使用建議

### 查看報告時：
1. 先看 **Data Logic** 工作表了解規則
2. 注意淺紅色標示的「無資料」行
3. 分析時可過濾掉 `Quality = "No Cases"` 的記錄
4. 年度數據已自動排除無資料季度

### 數據分析時：
```powershell
# PowerShell 範例：只分析有資料的記錄
$data = Import-Csv "quarterly_data_smart_20251110_130551.csv"
$validData = $data | Where-Object { [int]$_.ServerRecordCount -gt 0 }

# Python 範例
import pandas as pd
df = pd.read_csv("quarterly_data_smart_20251110_130551.csv")
valid_df = df[df['ServerRecordCount'] > 0]
```

---

## 📊 與舊版本比較

| 特性 | 舊版（假數據） | 舊版（全零） | **新版（智能）** |
|------|---------------|-------------|-----------------|
| 有資料時 | 隨機數字 | 0 | ✅ **原始值** |
| 無資料時 | 隨機數字 | 0 | ✅ **0 + "No Cases"** |
| 視覺區分 | ❌ 無 | ❌ 無 | ✅ **淺紅色** |
| 真實性 | ❌ 誤導 | ⚠️ 過度悲觀 | ✅ **真實反映** |
| 可用性 | ❌ 不可信 | ⚠️ 難分析 | ✅ **可直接使用** |

---

## 🎉 總結

此智能邏輯版本：
- ✅ **真實反映**資料狀況（有/無資料混合）
- ✅ **自動處理**無資料情況（設為0）
- ✅ **視覺標示**清楚易懂
- ✅ **保留有效數據**供分析使用
- ✅ **年度計算**只統計有資料的季度

**建議使用此版本進行後續分析！**

---

生成時間：2025-11-10 13:05:50
版本：Smart Logic v1.0
