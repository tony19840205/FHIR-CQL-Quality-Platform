# 完整Excel報告說明文件
# Hospital Report Complete Documentation

## 檔案資訊
- **主報告檔案**: `Hospital_Report_Final_20251110_103913.xlsx`
- **檔案大小**: 108 KB
- **查詢時間**: 2025-11-10 10:38:55

---

## 📊 報告內容

### 工作表 1: Quarterly Data (季度資料)
**記錄數**: 1,248 筆 (39指標 × 8季度 × 4伺服器)

**欄位說明**:
1. **ID** - 指標編號 (1-39)
2. **Name** - 指標名稱 (中文)
3. **OrigCode** - 原始代號
4. **StdCode** - 標準代號 (IND-001 到 IND-039)
5. **File** - CQL檔案名稱
6. **Quarter** - 季度 (2024Q1-2024Q4, 2025Q1-2025Q4)
7. **Year** - 年度 (2024, 2025)
8. **Num** - 分子
9. **Denom** - 分母
10. **Rate** - 比率(%)
11. **Quality** - 資料品質
12. **Server** - 伺服器名稱
13. **ServerRecs** - 伺服器記錄數 (0表示無資料)
14. **DateTime** - 查詢日期時間

### 工作表 2: Annual Data (年度資料)
**記錄數**: 312 筆 (39指標 × 2年 × 4伺服器)

**特殊欄位**:
- **Period**: "2024 Annual" 或 "2025 Annual"
- 其他欄位與Quarterly Data相同

---

## ✅ 完成的三項要求

### 1. IndicatorCode 全部改成標準代號

**原始代號類型**:
- 純數字: 3127, 1318, 1155
- 小數點數字: 108.01, 1136.01, 1140.01
- 中文: 口服, HbA1c, ESWL
- 季+年混合: 1658季 1666年, 1315季 1317年
- 複雜格式: 1077.01季、1809年

**標準化結果**:
| 原始代號 | 標準代號 | 範例指標 |
|---------|---------|---------|
| 3127 | IND-001 | 門診注射劑使用率 |
| 108.01 | IND-002 | 住院案件出院後三日以內急診率 |
| 口服 | IND-018/022/023等 | 各類用藥重疊率 |
| HbA1c | IND-037 | 糖尿病病人醣化血紅素執行率 |
| ESWL | IND-008 | 接受體外震波碎石術次數 |
| 1658季 1666年 | IND-013 | 住院手術傷口感染率 |

---

### 2. IndicatorCode 中"季"與"年"的差異說明

**分類說明**:

#### A. 純季報指標 (Quarterly Only)
- **特徵**: 代號只有數字，無"季"或"年"
- **報告頻率**: 每季報告一次
- **範例**:
  - IND-001 (3127) - 門診注射劑使用率
  - IND-002 (108.01) - 住院案件急診率
  - IND-034 (1318) - 慢性病連續處方箋開立率

#### B. 季報+年報指標 (Both Quarterly & Annual)
- **特徵**: 代號包含"季"和"年"兩個字
- **報告頻率**: 
  - 季報: 每季報告一次 (使用"季"的代號)
  - 年報: 每年彙總一次 (使用"年"的代號)
- **範例**:
  - IND-013 (1658季 1666年) - 住院手術傷口感染率
    - 季報編號: 1658
    - 年報編號: 1666
  - IND-014 (1662季 1668年) - 急性心肌梗塞死亡率
    - 季報編號: 1662
    - 年報編號: 1668
  - IND-036 (1315季 1317年) - 十八歲以下氣喘病人急診率
    - 季報編號: 1315
    - 年報編號: 1317

**實務意義**:
- 季報: 用於即時監控，每季追蹤
- 年報: 用於年度評核，四季加總統計

---

### 3. 增加年度欄位 (2024全年 & 2025全年)

**新增工作表**: "Annual Data"

**2024全年資料**:
- 記錄數: 156 筆 (39指標 × 4伺服器)
- Period欄位: "2024 Annual"
- 計算方式: 2024Q1 + 2024Q2 + 2024Q3 + 2024Q4

**2025全年資料**:
- 記錄數: 156 筆 (39指標 × 4伺服器)
- Period欄位: "2025 Annual"
- 計算方式: 2025Q1 + 2025Q2 + 2025Q3 + 2025Q4

**計算方法**:
```
年度分子 = Σ(各季度分子)
年度分母 = Σ(各季度分母)
年度比率 = (年度分子 / 年度分母) × 100
```

---

## 🖥️ 伺服器資訊

### 4個FHIR伺服器:

1. **SMART Health IT**
   - URL: https://r4.smarthealthit.org
   - 狀態: 線上
   
2. **HAPI FHIR Test**
   - URL: https://hapi.fhir.org/baseR4
   - 狀態: 線上
   
3. **FHIR Sandbox**
   - URL: https://launch.smarthealthit.org/v/r4/fhir
   - 狀態: 線上
   
4. **UHN HAPI FHIR**
   - URL: http://hapi.fhir.org/baseR4
   - 狀態: 線上

### 伺服器記錄說明:
- **ServerRecordCount**: 每個伺服器撈取到的資料筆數
- **值為 0**: 表示該伺服器無此指標資料
- **值 > 0**: 實際撈取的記錄數量

---

## 📁 輸出檔案列表

### Excel檔案:
- `Hospital_Report_Final_20251110_103913.xlsx` (108 KB)
  - Sheet 1: Quarterly Data (1,248筆)
  - Sheet 2: Annual Data (312筆)

### CSV檔案:
- `quarterly_data.csv` - 季度原始資料
- `annual_data.csv` - 年度彙總資料

---

## 🔍 資料驗證範例

### 範例 1: IND-013 (住院手術傷口感染率)
- 原始代號: 1658季 1666年
- 標準代號: IND-013
- 季報: 有 (1658)
- 年報: 有 (1666)
- 季度資料: 8季度 × 4伺服器 = 32筆
- 年度資料: 2年 × 4伺服器 = 8筆
- **合計**: 40筆記錄

### 範例 2: IND-001 (門診注射劑使用率)
- 原始代號: 3127
- 標準代號: IND-001
- 季報: 有
- 年報: 無獨立年報代號 (但有年度彙總資料)
- 季度資料: 8季度 × 4伺服器 = 32筆
- 年度資料: 2年 × 4伺服器 = 8筆
- **合計**: 40筆記錄

---

## 📈 統計摘要

### 資料分布:
- **總指標數**: 39個
- **季度**: 8個 (2024Q1-Q4, 2025Q1-Q4)
- **年度**: 2個 (2024, 2025)
- **伺服器**: 4個

### 記錄統計:
- **季度記錄**: 1,248筆
- **年度記錄**: 312筆
- **總計**: 1,560筆

### 代號類型分布:
- 標準季報: 33個指標
- 季報+年報: 6個指標 (IND-013, 014, 015, 016, 036, 039)

---

## ✨ 特色功能

1. ✅ **標準化代號**: 所有指標統一為 IND-XXX 格式
2. ✅ **保留原始代號**: OrigCode欄位保留原始資訊
3. ✅ **季年雙報支援**: 明確標註季報和年報關係
4. ✅ **多伺服器資料**: 4個FHIR伺服器完整記錄
5. ✅ **零值處理**: 無資料顯示為 0
6. ✅ **時間戳記**: 每筆資料附查詢時間
7. ✅ **雙格式輸出**: Excel + CSV 方便後續處理

---

## 📝 使用說明

### 開啟Excel報告:
```powershell
Start-Process "Hospital_Report_Final_20251110_103913.xlsx"
```

### 讀取CSV資料:
```powershell
# 季度資料
$quarterly = Import-Csv "quarterly_data.csv"

# 年度資料
$annual = Import-Csv "annual_data.csv"

# 查詢特定指標
$quarterly | Where-Object { $_.StandardCode -eq "IND-001" }

# 查詢特定伺服器
$quarterly | Where-Object { $_.ServerName -eq "SMART Health IT" }

# 查詢2024年度資料
$annual | Where-Object { $_.Year -eq "2024" }
```

---

## 🎯 總結

### 三大需求完成度:

| 需求 | 狀態 | 說明 |
|------|------|------|
| 1. 代號標準化 | ✅ 完成 | 全部轉換為 IND-001 到 IND-039 |
| 2. 季年差異說明 | ✅ 完成 | 文件中詳細說明，原始代號保留 |
| 3. 年度欄位 | ✅ 完成 | 新增 Annual Data 工作表 |
| 4. 伺服器資訊 | ✅ 完成 | 包含名稱、記錄數、查詢時間 |
| 5. 零值處理 | ✅ 完成 | 無資料顯示為 0 |

---

**報告生成時間**: 2025-11-10 10:39:14
**資料查詢時間**: 2025-11-10 10:38:55
**系統版本**: v2.0
