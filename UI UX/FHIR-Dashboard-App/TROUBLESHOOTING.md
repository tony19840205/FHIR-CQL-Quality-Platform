# 快速使用指南

## ⚠️ 重要提示

如果您看到 "0+ 筆患者資料"，這表示：
1. FHIR 伺服器已連線成功
2. 但該伺服器目前沒有資料，或資料格式不同

## 🔧 解決方案

### 方案 1：使用有資料的測試伺服器

推薦使用以下伺服器（有豐富測試資料）：

**HAPI FHIR R4（強力推薦）**
```
URL: https://hapi.fhir.org/baseR4
驗證令牌: 留空
```

這是最大的公開測試伺服器，有數千筆測試資料。

### 方案 2：查看控制台日誌

1. 按 `F12` 開啟開發者工具
2. 切換到 `Console` 標籤
3. 執行 CQL 查詢
4. 查看詳細的查詢日誌

您會看到：
- ✓ 成功查詢的資源
- ⚠ 沒有資料的資源
- ✗ 失敗的查詢

## 📋 使用步驟

### 步驟 1：設定 FHIR 伺服器（首頁）

1. 開啟 `index.html`
2. 選擇 "HAPI FHIR R4" 或輸入其他伺服器
3. 點擊「測試連線」
4. 確認看到「✓ 連線成功」

### 步驟 2：測試資料可用性（儀表板）

1. 點擊「疾管儀表板」
2. 頁面會自動顯示「快速資料測試」區塊
3. 系統會自動測試並顯示：
   - 患者資料數量
   - 就診記錄數量
   - 診斷記錄數量
   - 檢驗記錄數量

### 步驟 3：執行 CQL 查詢

1. 選擇任一疾病類型（COVID-19、流感等）
2. 點擊「執行查詢」
3. 等待查詢完成
4. 查看結果：
   - 總覽卡片會更新數字
   - 圖表會顯示趨勢和分布
   - 資料表會列出詳細記錄

## 🎯 測試建議

### 最佳測試流程

```
1. 首頁 → 選擇 HAPI FHIR R4 → 測試連線
   ↓
2. 疾管儀表板 → 自動測試資料
   ↓
3. 執行任一 CQL 查詢（建議先試 COVID-19）
   ↓
4. 查看結果 → 打開 Console 看詳細日誌
```

### 如果還是沒有資料

可能原因：
1. **伺服器真的沒資料** - 切換到 HAPI FHIR R4
2. **網路問題** - 檢查網路連線
3. **CORS 限制** - 某些伺服器不允許跨域請求
4. **伺服器暫時離線** - 稍後再試

## 📊 預期結果

### 使用 HAPI FHIR R4 時

您應該看到：
- ✅ 患者資料：10+ 筆
- ✅ 就診記錄：10+ 筆
- ✅ 診斷記錄：10+ 筆
- ✅ 檢驗記錄：10+ 筆

執行 CQL 查詢後：
- ✅ 總覽卡片顯示病例數（可能是 20-50 筆）
- ✅ 圖表顯示趨勢線
- ✅ 資料表列出詳細就診記錄

## 🐛 除錯技巧

### 1. 開啟 Console 日誌

按 `F12` → `Console` 標籤

您會看到：
```
========================================
開始執行 CQL 查詢: covid19
========================================
CQL Library: COVID19Cohort_NoID v1.1.0
FHIR Server: https://hapi.fhir.org/baseR4
查詢參數: {...}
開始執行 FHIR 查詢...
查詢 Patients...
Patient 查詢回應: {...}
✓ 找到 20 位患者
...
```

### 2. 檢查網路請求

按 `F12` → `Network` 標籤

篩選 `Fetch/XHR`，您會看到所有 FHIR API 請求。

### 3. 測試其他伺服器

如果當前伺服器沒資料，試試這些：

```
1. HAPI FHIR R4
   https://hapi.fhir.org/baseR4
   
2. HAPI FHIR R4 (EU)
   https://hapi.fhir.org/baseR4
   
3. UHN Test Server
   https://fhir.hl7fundamentals.org/r4
```

## ✨ 功能亮點

### 已實作功能

✅ **FHIR 連線管理**
- 支援多種伺服器
- Bearer Token 驗證
- 連線狀態監控

✅ **自動資料測試**
- 載入時自動檢測資料
- 顯示各類資源數量
- 友善的錯誤提示

✅ **CQL 查詢執行**
- 5 種傳染病監測
- 智能查詢策略
- 詳細日誌輸出

✅ **數據視覺化**
- 趨勢圖表
- 來源分布圖
- 年齡分布圖
- 互動式資料表

✅ **資料匯出**
- JSON 格式
- CSV 格式
- 完整病例資訊

## 📞 需要幫助？

查看 Console 日誌並告訴我：
1. 看到什麼錯誤訊息？
2. 使用哪個 FHIR 伺服器？
3. 快速資料測試顯示什麼？

---

**版本**: 1.0.1  
**更新日期**: 2025-11-12
