<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FHIR ä¼ºæœå™¨æ¸¬è©¦å·¥å…·</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 { color: #667eea; }
        .server-card {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status { 
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin: 5px 0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .testing { background: #fff3cd; color: #856404; }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #5568d3; }
        .info { font-size: 14px; color: #666; margin: 5px 0; }
        .url { 
            background: #f8f9fa; 
            padding: 8px; 
            border-radius: 4px; 
            font-family: monospace;
            word-break: break-all;
        }
        .details {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” FHIR å…¬é–‹æ¸¬è©¦ä¼ºæœå™¨é€£ç·šæ¸¬è©¦</h1>
    <p>æ¸¬è©¦å„å€‹ FHIR ä¼ºæœå™¨æ˜¯å¦å¯å¾ç€è¦½å™¨é€£ç·šï¼ˆCORS æª¢æŸ¥ï¼‰</p>
    
    <button onclick="testAllServers()">ğŸš€ æ¸¬è©¦æ‰€æœ‰ä¼ºæœå™¨</button>
    
    <div id="results"></div>

    <script>
        const servers = [
            {
                name: 'å°ç£è¡›ç¦éƒ¨ FHIR Server',
                url: 'https://thas.mohw.gov.tw/v/r4/fhir',
                recommended: true,
                description: 'å®˜æ–¹æ¸¬è©¦ç’°å¢ƒ - æ¨è–¦ä½¿ç”¨'
            },
            {
                name: 'Firely Server (R4)',
                url: 'https://server.fire.ly/r4',
                recommended: true,
                description: 'è·è˜­ Firely å…¬å¸çš„å…¬é–‹æ¸¬è©¦ä¼ºæœå™¨'
            },
            {
                name: 'SMART Health IT (R4)',
                url: 'https://r4.smarthealthit.org',
                recommended: true,
                description: 'SMART on FHIR å®˜æ–¹æ¸¬è©¦ä¼ºæœå™¨'
            },
            {
                name: 'HAPI FHIR (èˆŠç‰ˆ baseR4)',
                url: 'https://hapi.fhir.org/baseR4',
                recommended: false,
                description: 'âš ï¸ æ­¤è·¯å¾‘å·²å¤±æ•ˆ'
            }
        ];

        async function testServer(server) {
            const card = document.getElementById(`server-${servers.indexOf(server)}`);
            const statusEl = card.querySelector('.status');
            const detailsEl = card.querySelector('.details');
            
            statusEl.className = 'status testing';
            statusEl.textContent = 'ğŸ”„ æ¸¬è©¦ä¸­...';
            detailsEl.innerHTML = 'æ­£åœ¨é€£ç·š...';
            
            const startTime = Date.now();
            
            try {
                const response = await fetch(`${server.url}/metadata`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/fhir+json'
                    }
                });
                
                const elapsed = Date.now() - startTime;
                
                if (response.ok) {
                    const data = await response.json();
                    statusEl.className = 'status success';
                    statusEl.textContent = 'âœ… é€£ç·šæˆåŠŸ';
                    detailsEl.innerHTML = `
                        <strong>ç‹€æ…‹ç¢¼:</strong> ${response.status}<br>
                        <strong>å›æ‡‰æ™‚é–“:</strong> ${elapsed} ms<br>
                        <strong>FHIR ç‰ˆæœ¬:</strong> ${data.fhirVersion || 'N/A'}<br>
                        <strong>è»Ÿé«”:</strong> ${data.software?.name || 'N/A'} ${data.software?.version || ''}<br>
                        <strong>CORS:</strong> ${response.headers.get('Access-Control-Allow-Origin') || 'æœªè¨­å®š (ä½†å¯é€£ç·š)'}
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                const elapsed = Date.now() - startTime;
                statusEl.className = 'status error';
                statusEl.textContent = 'âŒ é€£ç·šå¤±æ•—';
                detailsEl.innerHTML = `
                    <strong>éŒ¯èª¤:</strong> ${error.message}<br>
                    <strong>æ™‚é–“:</strong> ${elapsed} ms<br>
                    ${error.message.includes('CORS') ? 
                        '<strong>åŸå› :</strong> æ­¤ä¼ºæœå™¨ä¸å…è¨±å¾ä½ çš„ç¶²åŸŸå­˜å– (CORS é™åˆ¶)' : 
                        '<strong>åŸå› :</strong> ä¼ºæœå™¨ç„¡å›æ‡‰æˆ–è·¯å¾‘éŒ¯èª¤'}
                `;
            }
        }

        function renderServers() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = servers.map((server, index) => `
                <div class="server-card" id="server-${index}">
                    <h3>${server.name} ${server.recommended ? 'â­' : ''}</h3>
                    <div class="info">${server.description}</div>
                    <div class="url">${server.url}</div>
                    <div class="status">å°šæœªæ¸¬è©¦</div>
                    <div class="details"></div>
                    <button onclick="testServer(servers[${index}])">æ¸¬è©¦æ­¤ä¼ºæœå™¨</button>
                </div>
            `).join('');
        }

        async function testAllServers() {
            for (let server of servers) {
                await testServer(server);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        // é é¢è¼‰å…¥æ™‚æ¸²æŸ“ä¼ºæœå™¨åˆ—è¡¨
        renderServers();
    </script>
</body>
</html>
